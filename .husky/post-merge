#!/bin/sh
# Post-merge hook: Clear cache after merging to prevent stale cache issues

echo "üîÑ Merge detected..."

# Check if critical files were modified in the merge
if git diff-tree -r --name-only HEAD@{1} HEAD | grep -qE "(package\.json|next\.config\.|tailwind\.config\.|tsconfig\.json)"; then
  echo "üì¶ Critical configuration files changed in merge, clearing cache..."
  rm -rf .next tsconfig.tsbuildinfo
  
  # Also check if package.json changed and suggest reinstall
  if git diff-tree -r --name-only HEAD@{1} HEAD | grep -q "package\.json"; then
    echo "‚ö†Ô∏è  package.json changed - consider running 'pnpm install' to update dependencies"
  fi
  
  echo "‚úÖ Cache cleared successfully"
else
  echo "‚ÑπÔ∏è  No critical config changes detected in merge, cache preserved"
fi